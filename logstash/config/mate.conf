# The input section
input {
  file {
    id => "csv001"
    add_field => { "[@metadata][source_type]" => "csv001" }
    path => "/home/ubuntu/intel/feeds/external/021_sslbl-abuse-ipblacklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv002"
    add_field => { "[@metadata][source_type]" => "csv002" }
    path => "/home/ubuntu/intel/feeds/external/021_sslbl-abuse-blacklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv003"
    add_field => { "[@metadata][source_type]" => "csv003" }
    path => "/home/ubuntu/intel/feeds/external/021_urlhaus-abuse-malwaredomainlist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv004"
    add_field => { "[@metadata][source_type]" => "csv004" }
    path => "/home/ubuntu/intel/feeds/external/017_alienvault-generic.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv005"
    add_field => { "[@metadata][source_type]" => "csv005" }
    path => "/home/ubuntu/intel/feeds/external/004_appspot-malwaredomainlist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv006a"
    add_field => { "[@metadata][source_type]" => "csv006a" }
    path => "/home/ubuntu/intel/feeds/external/015_bambek-malicious-c2-domains.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv006b"
    add_field => { "[@metadata][source_type]" => "csv006b" }
    path => "/home/ubuntu/intel/feeds/external/015_bambek-malicious-dga-domains.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv007"
    add_field => { "[@metadata][source_type]" => "csv007" }
    path => "/home/ubuntu/intel/feeds/external/015_bambek-c2-iplist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv008"
    add_field => { "[@metadata][source_type]" => "csv008" }
    path => "/home/ubuntu/intel/feeds/external/032_benkow-rat.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv009"
    add_field => { "[@metadata][source_type]" => "csv009" }
    path => "/home/ubuntu/intel/feeds/external/016_cinsscore-ci-badguys.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv010"
    add_field => { "[@metadata][source_type]" => "csv010" }
    path => "/home/ubuntu/intel/feeds/external/026_coinblockers-domains*"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv011"
    add_field => { "[@metadata][source_type]" => "csv011" }
    path => "/home/ubuntu/intel/feeds/external/025_conficker-domains.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv012"
    add_field => { "[@metadata][source_type]" => "csv012" }
    path => "/home/ubuntu/intel/feeds/external/005_cybercrime-tracker.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv013"
    add_field => { "[@metadata][source_type]" => "013" }
    path => "/home/ubuntu/intel/feeds/external/005_cybercrime-tracker-ccamgate.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv014"
    add_field => { "[@metadata][source_type]" => "csv014" }
    path => "/home/ubuntu/intel/feeds/external/005_cybercrime-tracker-ccamlist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv015"
    add_field => { "[@metadata][source_type]" => "csv015" }
    path => "/home/ubuntu/intel/feeds/external/027_cybercure-hashes.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv016"
    add_field => { "[@metadata][source_type]" => "csv016" }
    path => "/home/ubuntu/intel/feeds/external/027_cybercure-ipblocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv017"
    add_field => { "[@metadata][source_type]" => "csv017" }
    path => "/home/ubuntu/intel/feeds/external/027_cybercure-blocked-urls.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv018"
    add_field => { "[@metadata][source_type]" => "csv018" }
    path => "/home/ubuntu/intel/feeds/external/019_dataplane*"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv019"
    add_field => { "[@metadata][source_type]" => "csv019" }
    path => "/home/ubuntu/intel/feeds/external/003_emergingthreats-compromised.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv020"
    add_field => { "[@metadata][source_type]" => "csv020" }
    path => "/home/ubuntu/intel/feeds/external/012_feodotracker-abuse-ipblocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv021"
    add_field => { "[@metadata][source_type]" => "csv021" }
    path => "/home/ubuntu/intel/feeds/external/014_firehol-level1.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv022"
    add_field => { "[@metadata][source_type]" => "csv022" }
    path => "/home/ubuntu/intel/feeds/external/024_greensnow-ipblocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv023"
    add_field => { "[@metadata][source_type]" => "csv023" }
    path => "/home/ubuntu/intel/feeds/external/hphosts*"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv024"
    add_field => { "[@metadata][source_type]" => "csv024" }
    path => "/home/ubuntu/intel/feeds/external/028_ipspamlist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv025"
    add_field => { "[@metadata][source_type]" => "csv025" }
    path => "/home/ubuntu/intel/feeds/external/007_listdynamic-dns-blocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv026"
    add_field => { "[@metadata][source_type]" => "csv026" }
    path => "/home/ubuntu/intel/feeds/external/031_malshare-hashes.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv027"
    add_field => { "[@metadata][source_type]" => "csv027" }
    path => "/home/ubuntu/intel/feeds/external/030_mal-silo-ips.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv028"
    add_field => { "[@metadata][source_type]" => "csv028" }
    path => "/home/ubuntu/intel/feeds/external/030_mal-silo-urls.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv029"
    add_field => { "[@metadata][source_type]" => "csv029" }
    path => "/home/ubuntu/intel/feeds/external/013_openphish-free.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv030"
    add_field => { "[@metadata][source_type]" => "csv030" }
    path => "/home/ubuntu/intel/feeds/external/009_pan-unit42-diamondfox-panels.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv031"
    add_field => { "[@metadata][source_type]" => "csv031" }
    path => "/home/ubuntu/intel/feeds/external/006_phishtank.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv032"
    add_field => { "[@metadata][source_type]" => "csv032" }
    path => "/home/ubuntu/intel/feeds/external/010_pop3-gropers-ipblocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv033"
    add_field => { "[@metadata][source_type]" => "csv033" }
    path => "/home/ubuntu/intel/feeds/external/011_ransomwaretracker-abuse.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv034"
    add_field => { "[@metadata][source_type]" => "csv034" }
    path => "/home/ubuntu/intel/feeds/external/029_security-gives.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv035"
    add_field => { "[@metadata][source_type]" => "csv035" }
    path => "/home/ubuntu/intel/feeds/external/008_snort-ip-filter.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv036"
    add_field => { "[@metadata][source_type]" => "csv036" }
    path => "/home/ubuntu/intel/feeds/external/020_vxvault-url-list.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv037"
    add_field => { "[@metadata][source_type]" => "csv037" }
    path => "/home/ubuntu/intel/feeds/external/002_zeustracker-abuse-compromised.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }

  file {
    id => "csv038"
    add_field => { "[@metadata][source_type]" => "csv038" }
    path => "/home/ubuntu/intel/feeds/external/001_zeustracker-abuse-ipblocklist.csv"
    sincedb_path => "/var/tmp/.sincedb_ext"
    start_position => "beginning"
  }
}

# The filter section
filter {
  if [@metadata][source_type] == "csv001" {
    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch SSLBL Botnet C2 IP Blacklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "abuse.ch" }
      add_field => { "threat-source" => "abuse.ch SSLBL Botnet C2 IP Blacklist" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "PORT" }
      add_field => { "[threat-data][sub-type2]" => "port" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "seen", "ipaddr", "port" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{ipaddr}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][value2]" => "%{port}"
      }

      remove_field => [ "seen", "ipaddr", "port" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}
    }
  }

  if [@metadata][source_type] == "csv002" {
    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch SSLBL SSL Certificate Blacklist (SHA1 Fingerprints)" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "abuse.ch" }
      add_field => { "threat-source" => "abuse.ch SSLBL SSL Certificate Blacklist" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type1]" => "sha1" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "seen", "hash", "meta" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{hash}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][meta1]" => "%{meta}"
      }

      remove_field => [ "seen", "hash", "meta" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}
    }
  }

  if [@metadata][source_type] == "csv003" {
    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch URLhaus Database Dump" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "abuse.ch" }
      add_field => { "threat-source" => "abuse.ch URLhaus Database Dump" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "id", "dateadded", "url", "url_status", "threat", "tags", "urlhaus_link", "reporter" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{url}"
        "threat-timestamp" => "%{dateadded}"
        "[threat-data][meta1]" => "Threat: %{threat}, Status: %{url_status}, Tags: %{tags}, URLHaus Link: %{urlhaus_link}"
      }

      remove_field => [ "id", "dateadded", "url", "url_status", "threat", "tags", "urlhaus_link", "reporter" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}
    }
  }

  if [@metadata][source_type] == "csv004" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Alienvault Generic feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Alienvault" }
      add_field => { "threat-source" => "Alienvault Reputation Generic" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}%{SPACE}\#%{SPACE}%{GREEDYDATA:[threat-data][meta1]}" }
      overwrite => [ "[threat-data][value1]", "[threat-data][meta1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "alienvault" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "alienvault"}
    }
  }

  if [@metadata][source_type] == "csv005" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Appspot Malware Domain List" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Appspot" }
      add_field => { "threat-source" => "Appspot panwdbl" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s)
      add_tag => [ "appspot" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "appspot"}
    }
  }

  if [@metadata][source_type] == "csv006a" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Bambek consulting c2 malicious domains" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Bambek Consulting" }
      add_field => { "threat-source" => "C2 and DGA malicious domains" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "DOMAIN" }
      add_field => { "[threat-data][sub-type1]" => "domain" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "maldomain", "details1", "seen", "details2" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{maldomain}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][meta1]" => "Threat use: %{details1}, Threat Info: %{details2}"
      }

      remove_field => [ "maldomain", "details1", "seen", "details2" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "bambek" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "bambek"}
    }
  }

  if [@metadata][source_type] == "csv006b" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Bambek consulting dga malicious domains" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Bambek Consulting" }
      add_field => { "threat-source" => "C2 and DGA malicious domains" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "DOMAIN" }
      add_field => { "[threat-data][sub-type1]" => "domain" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "maldomain", "details1", "seen", "details2" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{maldomain}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][meta1]" => "Threat use: %{details1}, Threat Info: %{details2}"
      }

      remove_field => [ "maldomain", "details1", "seen", "details2" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "bambek" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "bambek"}
    }
  }

  if [@metadata][source_type] == "csv007" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Bambek consulting c2 IP master list" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Bambek Consulting" }
      add_field => { "threat-source" => "C2 IP blocklist" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "ipaddr", "details1", "seen", "details2" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{ipaddr}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][meta1]" => "Threat use: %{details1}, Threat Info: %{details2}"
      }

      remove_field => [ "ipaddr", "details1", "seen", "details2" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "bambek" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "bambek"}
    }
  }

  if [@metadata][source_type] == "csv008" {

    # Required Fields
    mutate {
      add_field => { "comments" => "benkow.cc RAT" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "benkow.cc" }
      add_field => { "threat-source" => "benkow.cc RAT" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "IP" }
      add_field => { "[threat-data][sub-type2]" => "ip-dst" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      separator => ";"
      columns => [ "id", "type", "url", "ip", "date", "column6" ]
    }

    if [message] =~ /^id/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{url}"
        "[threat-data][value2]" => "%{ip}"
        "[threat-data][meta1]" => "%{type}"
        "threat-timestamp" => "%{date}"
      }

      remove_field => [ "id", "type", "url", "ip", "date", "column6" ]
    }

    date {
      match => ["threat-timestamp", "dd-MM-yyyy"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "benkow" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "benkow"}
    }
  }

  if [@metadata][source_type] == "csv009" {
    # Required Fields
    mutate {
      add_field => { "comments" => "CINSscore Badguys IP blocklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "CIN Score" }
      add_field => { "threat-source" => "CINS Army List" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "cinsscore" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cinsscore"}
    }
  }

  if [@metadata][source_type] == "csv010" {

    # Required Fields
    mutate {
      add_field => { "comments" => "CoinBlockerLists - cryptomining domains." }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "CoinBlockerLists" }
      add_field => { "threat-source" => "CoinBlockerLists - cryptomining domains." }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "DOMAIN" }
      add_field => { "[threat-data][sub-type1]" => "domain" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{URI:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "coinblockers" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "coinblockers"}
    }
  }

  if [@metadata][source_type] == "csv011" {
    # Required Fields
    mutate {
      add_field => { "comments" => "CERT Austria conficker all domains" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "CERT Austria - cert.at" }
      add_field => { "threat-source" => "CERT Austria conficker all domains" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "DOMAIN" }
      add_field => { "[threat-data][sub-type1]" => "domain" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "conficker-cert-at" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "conficker-cert-at"}
    }
  }

  if [@metadata][source_type] == "csv012" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercrime Tracker List" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercrime Tracker" }
      add_field => { "threat-source" => "Cybercrime Tracker List (all)" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "cybercrime-tracker" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercrime-tracker"}
    }
  }

  if [@metadata][source_type] == "csv013" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercrime Tracker Gate List" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercrime Tracker" }
      add_field => { "threat-source" => "Cybercrime Tracker List (ccam gate)" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      separator => "|"
      columns => [ "url", "file" ]
    }

    if [file] =~ /file=/ {
      grok {
        match => { "file" => "file=%{GREEDYDATA:[threat-data][value2]}" }
        overwrite => [ "[threat-data][value2]" ]
      }

      mutate {
        update => {
          "[threat-data][type2]" => "FILENAME"
          "[threat-data][sub-type2]" => "filename"
          "[threat-data][has-types]" => "true"
        }
      }
    }

    if [file] =~ /menu=/ {
      grok {
        match => { "file" => "menu=%{GREEDYDATA:[threat-data][value2]}" }
        overwrite => [ "[threat-data][value2]" ]
      }

      mutate {
        update => {
          "[threat-data][type2]" => "FILENAME"
          "[threat-data][sub-type2]" => "filename"
          "[threat-data][has-types]" => "true"
        }
      }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{url}"
      }

      remove_field => [ "url", "file" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "cybercrime-tracker" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercrime-tracker"}
    }
  }

  if [@metadata][source_type] == "csv014" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercrime Tracker Hash List" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercrime Tracker" }
      add_field => { "threat-source" => "Cybercrime Tracker List (hash)" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type1]" => "sha1" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {

      # Add Tag(s) for new documents.
      add_tag => [ "cybercrime-tracker" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercrime-tracker"}
    }
  }

  if [@metadata][source_type] == "csv015" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercure AI IP Feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercure AI" }
      add_field => { "threat-source" => "Cybercure AI Hash Feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type1]" => "sha256" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {

      # Add Tag(s) for new documents.
      add_tag => [ "cybercure" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercure"}
    }
  }

  if [@metadata][source_type] == "csv016" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercure AI IP Feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercure AI" }
      add_field => { "threat-source" => "Cybercure AI IP Feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {

      # Add Tag(s) for new documents.
      add_tag => [ "cybercure" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercure"}
    }
  }

  if [@metadata][source_type] == "csv017" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Cybercure AI IP Feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Cybercure AI" }
      add_field => { "threat-source" => "Cybercure AI Blocked URL Feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{URI:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "cybercure" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "cybercure"}
    }
  }

  if [@metadata][source_type] == "csv018" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Intel lists from dataplane.org" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "dataplane.org" }
      add_field => { "threat-source" => "SIP, SSH, VNC lists from dataplane.org" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      separator => "|"
      columns => [ "asn", "asninfo", "ipaddr", "seen", "meta" ]
    }

    mutate { strip => [ "ipaddr", "seen", "meta" ] }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{ipaddr}"
        "threat-timestamp" => "%{seen}"
        "[threat-data][meta1]" => "Threat details: %{meta}"
      }

      remove_field => [ "asn", "asninfo", "ipaddr", "seen", "meta" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "dataplane" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "dataplane"}
    }
  }

  if [@metadata][source_type] == "csv019" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Emerging Threats rule server compromised IPs" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Emerging Threats" }
      add_field => { "threat-source" => "Emerging Threats rule server" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "emerging-threats" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "emerging-threats"}
    }
  }

  if [@metadata][source_type] == "csv020" {

    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch Feodo Tracker Botnet C2 IP Blocklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Abuse.ch" }
      add_field => { "threat-source" => "Feodo Tracker Botnet C2 IP Blocklist" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "PORT" }
      add_field => { "[threat-data][sub-type2]" => "port" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    csv {
      skip_header => true
      columns => [ "Firstseen", "DstIP" , "DstPort", "LastOnline", "Malware" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{DstIP}"
        "[threat-data][value2]" => "%{DstPort}"
        "threat-timestamp" => "%{Firstseen}"
        "[threat-data][meta1]" => "Malware Info: %{Malware}"
      }

      remove_field => [ "Firstseen", "DstIP" , "DstPort", "LastOnline", "Malware" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}
    }
  }

  if [@metadata][source_type] == "csv021" {
    # Required Fields
    mutate {
      add_field => { "comments" => "FireHOL Level 1 IP subnet firewall blacklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "FireHOL" }
      add_field => { "threat-source" => "http://iplists.firehol.org/?ipset=firehol_level1" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "" }
      add_field => { "[threat-data][sub-type1]" => "" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    if [message] =~ /^#/ {
      drop { }
    }

    grok {
      match => { "message" => "%{GREEDYDATA:data}" }
      overwrite => [ "data" ]
    }

    if (["/"] in [data]) {
      mutate {
        update => {
          "[threat-data][value1]" => "%{data}"
          "[threat-data][type1]" => "SUBNET"
          "[threat-data][sub-type1]" => "subnet"
        }
      }
    }
    else {
      mutate {
        update => {
          "[threat-data][value1]" => "%{data}"
          "[threat-data][type1]" => "IP"
          "[threat-data][sub-type1]" => "ip-dst"
        }
      }
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "firehol" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "firehol"}

      remove_field => [ "data" ]
    }
  }

  if [@metadata][source_type] == "csv022" {
    # Required Fields
    mutate {
      add_field => { "comments" => "GreenSnow.co blacklisted IPs" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "GreenSnow.co" }
      add_field => { "threat-source" => "GreenSnow.co blacklisted IPs" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "greensnow" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "greensnow"}
    }
  }

  if [@metadata][source_type] == "csv023" {
    # Required Fields
    mutate {
      add_field => { "comments" => "hpHosts database with PSH, EMD, and GRM classifications" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "hpHosts" }
      add_field => { "threat-source" => "hpHosts PSH, EMD, and GRM classifications" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "HOSTNAME" }
      add_field => { "[threat-data][sub-type1]" => "hostname" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    # Feed processing MUST result in (atleast) one field: "[threat-data][value1]"
    # Grok "overwrite" must be used to overwrite the above processed fields and to prevent field array creation.

    # Example for the Alienvault feed at http://reputation.alienvault.com/reputation.generic
    csv {
      skip_header => true
      columns => [ "localip", "host" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{host}"
      }

      remove_field => [ "localip", "host" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "hphosts" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "hphosts"}
    }
  }

  if [@metadata][source_type] == "csv024" {
    # Required Fields
    mutate {
      add_field => { "comments" => "ipspamlist public feeds" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "ipspamlist.com" }
      add_field => { "threat-source" => "ipspamlist public feeds" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "first_seen", "last_seen", "ip_address", "category", "attacks_count" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{ip_address}"
        "threat-timestamp" => "%{first_seen}"
        "[threat-data][meta1]" => "Category: %{category}, Attack Count: %{attacks_count}"
      }

      remove_field => [ "first_seen", "last_seen", "ip_address", "category", "attacks_count" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "ipspamlist" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "ipspamlist"}
    }
  }

  if [@metadata][source_type] == "csv025" {
    # Required Fields
    mutate {
      add_field => { "comments" => "List Dynamic DNS blocklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "dns-bh.sagadc.org/dynamic_dns.txt" }
      add_field => { "threat-source" => "Suspicious Dynamic DNS Providers" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "DOMAIN" }
      add_field => { "[threat-data][sub-type1]" => "domain" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    if ([message] =~ /^#/) {
      drop{ }
    }

    grok {
      match => { "message" => "%{HOSTNAME:[threat-data][value1]}%{GREEDYDATA:[threat-data][meta1]}" }
      overwrite => [ "[threat-data][value1]", "[threat-data][meta1]" ]
    }

    mutate {
      strip => ["comments"]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "list-dynamic" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "list-dynamic"}
    }
  }

  if [@metadata][source_type] == "csv026" {
    # Required Fields
    mutate {
      add_field => { "comments" => "MalShare daily hash list" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "MalShare Project" }
      add_field => { "threat-source" => "MalShare daily hashes list" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "true" }
      add_field => { "[threat-data][type1]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type1]" => "sha256" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type2]" => "sha1" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }
      add_field => { "[threat-data][type3]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type3]" => "md5" }
      add_field => { "[threat-data][value3]" => "" }
      add_field => { "[threat-data][meta3]" => "" }
      add_field => { "[threat-data][type4]" => "SSDEEP" }
      add_field => { "[threat-data][sub-type4]" => "ssdeep" }
      add_field => { "[threat-data][value4]" => "" }
      add_field => { "[threat-data][meta4]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "hmd5", "hsha1", "hsha256", "ssdeep" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{hsha256}"
        "[threat-data][value2]" => "%{hsha1}"
        "[threat-data][value3]" => "%{hmd5}"
        "[threat-data][value4]" => "%{ssdeep}"
      }

      remove_field => [ "hmd5", "hsha1", "hsha256", "ssdeep" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "malshare" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "malshare"}
    }
  }

  if [@metadata][source_type] == "csv027" {
    # Required Fields
    mutate {
      add_field => { "comments" => "MalSilo IPv4 feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "MalSilo" }
      add_field => { "threat-source" => "MalSilo IPv4 feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "Firstseen", "Lastseen", "ipv4:port" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    grok {
      match => { "ipv4:port" => "%{IP:[threat-data][value1]}:%{GREEDYDATA:[threat-data][value2]}" }
      overwrite => [ "[threat-data][value1]", "[threat-data][value2]" ]
    }

    mutate {
      update => {
        "threat-timestamp" => "%{Firstseen}"
      }

      remove_field => [ "Firstseen", "Lastseen", "ipv4:port" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "malsilo" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "malsilo"}
    }
  }

  if [@metadata][source_type] == "csv028" {
    # Required Fields
    mutate {
      add_field => { "comments" => "MalSilo URL feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "MalSilo" }
      add_field => { "threat-source" => "MalSilo URL feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "Firstseen", "Lastseen", "url" ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{url}"
        "threat-timestamp" => "%{Firstseen}"
      }

      remove_field => [ "Firstseen", "Lastseen", "url" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "malsilo" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "malsilo"}
    }
  }

  if [@metadata][source_type] == "csv029" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Openphish Phishing feeds (free)" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Openphish.com" }
      add_field => { "threat-source" => "Openphish phishing feed free version" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "openphish" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "openphish"}
    }
  }

  if [@metadata][source_type] == "csv030" {
    # Required Fields
    mutate {
      add_field => { "comments" => "pan unit42 diamondfox botnet" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Palo Alto Networks Unit42 Public Reports" }
      add_field => { "threat-source" => "pan unit42" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "FILEHASH" }
      add_field => { "[threat-data][sub-type1]" => "sha256" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "URL" }
      add_field => { "[threat-data][sub-type2]" => "url" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    csv {
      columns => [ "url", "time", "hash" ]
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{hash}"
        "threat-timestamp" => "%{time}"
        "[threat-data][value2]" => "%{url}"
      }

      remove_field => ["url", "time", "hash"]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    mutate {
      gsub => [ "[threat-data][value2]", "hxxp", "http" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "pan-diamondfox" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "pan-diamondfox"}
    }
  }

  if [@metadata][source_type] == "csv031" {
    # Required Fields
    mutate {
      add_field => { "comments" => "phishtank Phishing URLs" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "phistank" }
      add_field => { "threat-source" => "phishtank Phishing URLs" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    csv {
      skip_header => true
      columns => [ "phish_id", "url", "phish_detail_url", "submission_time", "verified", "verification_time", "online", "target" ]
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{url}"
        "threat-timestamp" => "%{verification_time}"
        "[threat-data][meta1]" => "Phishtank ID: %{phish_id}, Details: %{phish_detail_url}, Online: %{online}, Target: %{target}"
      }

      remove_field => ["phish_id", "url", "phish_detail_url", "submission_time", "verified", "verification_time", "online", "target"]
    }

    date {
      match => ["threat-timestamp", "ISO8601"]
      target => "threat-timestamp"
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "phishtank" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "phishtank"}
    }
  }

  if [@metadata][source_type] == "csv032" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Hosts that tried and failed to log on to the pop3 service at bsdly.net" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "home.nuug.no" }
      add_field => { "threat-source" => "home.nuug.no" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "pop3-gropers" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "pop3-gropers"}
    }
  }

  if [@metadata][source_type] == "csv033" {

    # Required Fields
    mutate {
      add_field => { "comments" => "Abuse.ch ransomware tracker feed" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }
      add_field => { "threat-uuid" => "" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Abuse.ch" }
      add_field => { "threat-source" => "Ransomware Tracker CSV Feed" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "true" }
      add_field => { "[threat-data][has-types]" => "true" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "HOSTNAME" }
      add_field => { "[threat-data][sub-type2]" => "hostname" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    csv {
      skip_header => true
      columns => [ "Firstseen (UTC)", "Threat", "Malware", "Host", "URL", "Status", "Registrar", "IP address(es)", "ASN(s)", "Country" ]
    }

    mutate {
      gsub => [ '%{IP address(es)}', '\"', '' ]
    }

    if [message] =~ /^#/ {
      drop { }
    }

    mutate {
      update => {
        "[threat-data][value1]" => "%{URL}"
        "[threat-data][value2]" => "%{Host}"
        "threat-timestamp" => "%{Firstseen (UTC)}"
        "[threat-data][meta1]" => "Threat Info: %{Threat}, Malware Info: %{Malware}, Status Info: %{Status}"
        "[threat-data][meta2]" => "Affecting IP address(es): %{IP address(es)}"
      }

      remove_field => [ "Firstseen (UTC)", "Threat", "Malware", "Host", "URL", "Status", "Registrar", "IP address(es)", "ASN(s)", "Country" ]
    }

    date {
      match => ["threat-timestamp", "yyyy-MM-dd HH:mm:ss"]
      target => "threat-timestamp"
    }

    # Handle parsing failures
    if "_grokparsefailure" in [tags] or "_csvparsefailure" in [tags] {
      drop { }
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      convert => {
        "threat-analysis" => "integer"
        "threat-level-id" => "integer"
        "threat-has-types" => "boolean"
        "[threat-data][has-types]" => "boolean"
        "[threat-data][has-meta]" => "boolean"
        "[threat-data][is-extended]" => "boolean"
        "occurrences" => "integer"
      }

      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}

      # Remove unused field(s)
      remove_field => [ "message" ]

    }
  }

  if [@metadata][source_type] == "csv034" {
    # Required Fields
    mutate {
      add_field => { "comments" => "Mirai Live Tracker - security.gives" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "security.gives" }
      add_field => { "threat-source" => "Mirai Live Tracker - security.gives" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "security-gives" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "security-gives"}
    }
  }

  if [@metadata][source_type] == "csv035" {

    # Required Fields
    mutate {
      add_field => { "comments" => "Snort IP Filter" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Snort Labs" }
      add_field => { "threat-source" => "Snort IP Filter list" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    # Handle parsing failures
    if "_grokparsefailure" in [tags] {
      drop { }
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "snort" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "snort"}
    }
  }

  if [@metadata][source_type] == "csv036" {
    # Required Fields
    mutate {
      add_field => { "comments" => "VX Vault last 100 Links" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "VX Vault" }
      add_field => { "threat-source" => "VX Vault last 100 Links" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#
    if [message] =~ /^#/ {
      drop { }
    }

    grok {
      match => { "message" => "%{URI:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "vxvault" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "vxvault"}
    }
  }

  if [@metadata][source_type] == "csv037" {

    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch ZeuS compromised URL blocklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Abuse.ch" }
      add_field => { "threat-source" => "ZeuS compromised URL blocklist" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "URL" }
      add_field => { "[threat-data][sub-type1]" => "url" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{GREEDYDATA:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}
    }
  }

  if [@metadata][source_type] == "csv038" {
    # Required Fields
    mutate {
      add_field => { "comments" => "abuse.ch ZeuS IP blocklist" }
      add_field => { "exportable-to-ids" => "true" }
      add_field => { "occurrences" => 1 }
      add_field => { "threat-analysis" => "2" }
      add_field => { "threat-level-id" => "2" }
      add_field => { "threat-published" => "true" }
      add_field => { "threat-timestamp" => "%{@timestamp}" }
      add_field => { "timestamp" => "%{@timestamp}" }

      #--------------------------------------------------------------------#
      # Update the fields below:
      #--------------------------------------------------------------------#
      # Category is one of: "Network activity", "Payload delivery",
      # "Artifacts dropped", "External analysis", or "Attribution"
      add_field => { "threat-category" => "Network activity" }

      add_field => { "threat-organization" => "Abuse.ch" }
      add_field => { "threat-source" => "ZeuS IP blocklist (standard)" }

      # Threat Data
      add_field => { "[threat-data][has-meta]" => "false" }
      add_field => { "[threat-data][has-types]" => "false" }
      add_field => { "[threat-data][is-extended]" => "false" }
      add_field => { "[threat-data][type1]" => "IP" }
      add_field => { "[threat-data][sub-type1]" => "ip-dst" }
      add_field => { "[threat-data][value1]" => "" }
      add_field => { "[threat-data][meta1]" => "" }
      add_field => { "[threat-data][type2]" => "" }
      add_field => { "[threat-data][sub-type2]" => "" }
      add_field => { "[threat-data][value2]" => "" }
      add_field => { "[threat-data][meta2]" => "" }

    }

    #--------------------------------------------------------------------#
    #--------------------Add feed-specific actions here:-----------------#
    #--------------------------------------------------------------------#

    grok {
      match => { "message" => "%{IP:[threat-data][value1]}" }
      overwrite => [ "[threat-data][value1]" ]
    }

    #--------------------------------------------------------------------#
    #--------------------End of feed-specific actions--------------------#
    #--------------------------------------------------------------------#

    mutate {
      # Add Tag(s) for new documents.
      add_tag => [ "abuse-ch" ]

      # For existing documents, update tags to indicate information overlaps in feeds.
      # The "extratag" field will be removed in the script in output.
      add_field => { "extratag" => "abuse-ch"}

    }
  }

  #############################################################################
  # Common configuration for all inputs.
  #############################################################################

  # Translations for Codes and Analysis
  translate {
    field => "threat-analysis"
    destination => "threat-analysis-code"
    dictionary => [
    "0", "Initial",
    "1", "Ongoing",
    "2", "Complete"
    ]
  }

  translate {
    field => "threat-level-id"
    destination => "threat-level-code"
    dictionary => [
    "1", "High",
    "2", "Medium",
    "3", "Low",
    "4", "Undefined"
    ]
  }

  # Parse IP for GeoIP coordinates
  # Adds an additional "threat-ip" field
  grok {
    match => { "[threat-data][value1]" => "%{IP:threat-geoip}" }
    tag_on_failure => [ ]
  }

  geoip {
    source => "threat-geoip"
    database => "/home/ubuntu/GeoLite2-ASN_20190528/GeoLite2-ASN.mmdb"
    tag_on_failure => [ ]
  }

  geoip {
    source => "threat-geoip"
    tag_on_failure => [ ]
  }

  mutate {
    add_field => { "threat-uuid" => "" }

    convert => {
      "threat-analysis" => "integer"
      "threat-level-id" => "integer"
      "threat-has-types" => "boolean"
      "[threat-data][has-types]" => "boolean"
      "[threat-data][has-meta]" => "boolean"
      "[threat-data][is-extended]" => "boolean"
      "occurrences" => "integer"
    }

    # Remove unused field(s)
    remove_field => [ "message", "threat-geoip" ]
  }

  uuid {
    target    => "threat-uuid"
    overwrite => true
  }

  # Fingerprinting to remove duplicates
  fingerprint {
    concatenate_sources => true
    source => ["[threat-data][type1]", "[threat-data][value1]"]
    target => "[@metadata][fingerprint]"
    method => "MURMUR3"
  }

  # Handle parsing failures
  if "_jsonparsefailure" in [tags] or "_grokparsefailure" in [tags] or "_csvparsefailure" in [tags] {
    drop { }
  }
}
# End of Filter Section.

# The output section
output {
  stdout {
    codec => rubydebug
  }
  elasticsearch {
    hosts => localhost
    action => "update"
    doc_as_upsert => true
    # manage_template => true
    script => '
    if (ctx._source.occurrences != null) {
      ctx._source.occurrences++;
    }
    if(ctx._source.tags.contains(params.event.get("extratag")) == false) {
      ctx._source.tags.add("%{extratag}");
    }
    ctx._source.remove("extratag")
    '
    # Replace "document_id" with "fingerprint"
    document_id => "%{[@metadata][fingerprint]}"
    index => "threats"
  }
}
